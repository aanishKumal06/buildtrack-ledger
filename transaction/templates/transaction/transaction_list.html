{% extends 'base/base.html' %}
{% load i18n %}

{% block content %}
<div class="container mt-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>{% trans "Transactions" %}</h2>
        <div>
            <a href="{% url 'expense_add' %}" class="btn btn-danger me-2">
                <i class="bi bi-currency-dollar"></i> {% trans "Add Expense" %}
            </a>
            <a href="{% url 'income_add' %}" class="btn btn-success">
                <i class="bi bi-wallet2"></i> {% trans "Add Income" %}
            </a>
        </div>
    </div>

    <!-- Tabs for Income and Expense -->
    <ul class="nav nav-tabs mb-3" id="transactionTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="income-tab" data-bs-toggle="tab" data-bs-target="#income" type="button" role="tab">
                {% trans "Incomes" %}
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="expense-tab" data-bs-toggle="tab" data-bs-target="#expense" type="button" role="tab">
                {% trans "Expenses" %}
            </button>
        </li>
    </ul>

    <div class="tab-content" id="transactionTabContent">
        <!-- Income Table -->
        <div class="tab-pane fade show active" id="income" role="tabpanel">
            <div class="card mb-4">
                <div class="card-body p-0">
                    <table class="table table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>{% trans "Project" %}</th>
                                <th>{% trans "Date" %}</th>
                                <th>{% trans "Amount" %}</th>
                                <th>{% trans "Payment Method" %}</th>
                                <th>{% trans "Added By" %}</th>
                                <th>{% trans "Actions" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for income in incomes %}
                            <tr>
                                <td>{{ income.project.name }}</td>
                                <td>{{ income.date }}</td>
                                <td>Rs. {{ income.amount }}</td>
                                <td>{{ income.get_payment_method_display }}</td>
                                <td>{{ income.added_by.get_full_name|default:income.added_by.email }}</td>
                                <td>
                                    {% if income.file %}
                                        <a href="{{ income.file.url }}" target="_blank" class="btn btn-sm btn-outline-info">
                                            {% trans "View" %}
                                        </a>
                                    {% endif %}
                                    {% if user.is_staff or income.added_by == user %}
                                    <a href="{% url 'income_update' income.pk %}" class="btn btn-sm btn-outline-primary">{% trans "Edit" %}</a>
                                    <a href="{% url 'income_delete' income.pk %}" class="btn btn-sm btn-outline-danger">{% trans "Delete" %}</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-muted py-3">{% trans "No incomes found." %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Expense Table -->
        <div class="tab-pane fade" id="expense" role="tabpanel">
            <div class="card mb-4">
                <div class="card-body p-0">
                    <table class="table table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>{% trans "Project" %}</th>
                                <th>{% trans "Date" %}</th>
                                <th>{% trans "Category" %}</th>
                                <th>{% trans "Amount" %}</th>
                                <th>{% trans "Added By" %}</th>
                                <th>{% trans "Actions" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for expense in expenses %}
                            <tr>
                                <td>{{ expense.project.name }}</td>
                                <td>{{ expense.date }}</td>
                                <td>{{ expense.get_category_display }}</td>
                                <td>Rs. {{ expense.amount }}</td>
                                <td>{{ expense.added_by.get_full_name|default:expense.added_by.email }}</td>
                                <td>
                                    {% if expense.file %}
                                        <a href="{{ expense.file.url }}" target="_blank" class="btn btn-sm btn-outline-info">
                                            {% trans "View" %}
                                        </a>
                                    {% endif %}
                                    <a href="{% url 'expense_update' expense.pk %}" class="btn btn-sm btn-outline-primary">{% trans "Edit" %}</a>
                                    <a href="{% url 'expense_delete' expense.pk %}" class="btn btn-sm btn-outline-danger">{% trans "Delete" %}</a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-muted py-3">{% trans "No expenses found." %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

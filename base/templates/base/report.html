{% extends 'base/base.html' %}
{% load i18n %}

{% block title %} {% trans "Overall Report" %} {% endblock title %}

{% block content %}
<div class="container mt-4">

    <h2 class="fw-bold mb-4 text-center">{% trans "Overall Project Report" %}</h2>

    <!-- Summary Cards -->
    <div class="row text-center mb-4">
        <div class="col-md-3">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="text-muted">{% trans "Total Income" %}</h5>
                    <h3 class="text-success fw-bold">RS. {{ total_income }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="text-muted">{% trans "Total Expense" %}</h5>
                    <h3 class="text-danger fw-bold">RS. {{ total_expense }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="text-muted">{% trans "Total Profit" %}</h5>
                    <h3 class="{% if p.is_profit %}text-success{% else %}text-danger{% endif %}">
                        RS. {{ p.profit_loss }}
                    </h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h5 class="text-muted">{% trans "Avg. Progress" %}</h5>
                    <h3 class="text-primary fw-bold">{{ avg_progress }}%</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-10">
            <canvas id="overallChart" height="100"></canvas>
        </div>
    </div>

    <!-- Project Table -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>{% trans "Project" %}</th>
                    <th>{% trans "Status" %}</th>
                    <th>{% trans "Income" %}</th>
                    <th>{% trans "Expense" %}</th>
                    <th>{% trans "Profit/Loss" %}</th>
                    <th>{% trans "Progress" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for p in projects %}
                <tr>
                    <td>{{ p.name }}</td>
                    <td>{{ p.get_status_display }}</td>
                    <td>RS. {{ p.total_income }}</td>
                    <td>RS. {{ p.total_expense }}</td>
                    <td class=lass="{% if p.is_profit %}text-success{% else %}text-danger{% endif %}">
                        RS. {{ p.profit_loss }}</td>
                    <td>{{ p.overall_progress }}%</td>

                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center">{% trans "No projects found." %}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('overallChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ chart_labels|safe }},
        datasets: [{
            label: '{% trans "Profit/Loss per Project" %}',
            data: {{ chart_data|safe }},
            backgroundColor: '#0d6efd',
            borderRadius: 8,
            barThickness: 30
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});
</script>
{% endblock content %}
